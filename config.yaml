# =============================================================================
# NMS Lite Configuration
# =============================================================================
# Environment variable override: NMS_<SECTION>_<KEY> (e.g., NMS_SERVER_PORT)
# =============================================================================

server:
  host: "0.0.0.0"
  port: 8080
  read_timeout_ms: 30000
  write_timeout_ms: 30000

# TLS Configuration (Required for production)
tls:
  enabled: true
  cert_file: "./certs/server.crt"
  key_file: "./certs/server.key"

# CORS Configuration
cors:
  enabled: true
  allowed_origins: ["http://localhost:3000"]
  allowed_methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  allowed_headers: ["Authorization", "Content-Type"]
  max_age_seconds: 3600

database:
  host: "localhost"
  port: 5432
  user: "nmslite"
  password: "nmslite"
  dbname: "nmslite"
  ssl_mode: "disable"
  api_pool:
    max_conns: 5
    min_conns: 1
    max_conn_lifetime_minutes: 30
    max_conn_idle_time_minutes: 5
    health_check_period_seconds: 30
  metrics_pool:
    max_conns: 3
    min_conns: 1
    max_conn_lifetime_minutes: 30
    max_conn_idle_time_minutes: 5
    health_check_period_seconds: 30

# Authentication & Security
auth:
  admin_username: "admin"
  admin_password: "Admin@123"
  jwt_secret: "99999999999999999999999999999999"
  jwt_expiry_hours: 24
  encryption_key: "99999999999999999999999999999999"

# Poller Configuration
poller:
  worker_pool_size: 50
  liveness_pool_size: 500
  liveness_timeout_ms: 2000
  liveness_batch_size: 50
  batch_flush_interval_ms: 100
  plugin_timeout_ms: 60000
  down_threshold: 3

# Scheduler Configuration
scheduler:
  tick_interval_ms: 10000 # How often to check the priority queue (10s default)
  liveness_workers: 100 # Max concurrent TCP SYN probes (semaphore limit)
  plugin_workers: 50 # Max concurrent plugin executions (semaphore limit)
  liveness_timeout_ms: 2000 # TCP SYN timeout
  plugin_timeout_ms: 60000 # Plugin execution timeout
  down_threshold: 3 # Consecutive failures before marking down

# Metrics Storage
metrics:
  batch_size: 100
  flush_interval_ms: 10
  retention_days: 90
  compression_after_hours: 1
  max_buffer_size: 10000
  max_metric_age_minutes: 5

# Discovery Configuration
discovery:
  max_discovery_workers: 100
  default_port_timeout_ms: 1000
  handshake_timeout_ms: 5000

# Plugin Configuration
plugins:
  directory: "./plugin_bins/"
  scan_interval_seconds: 60

# Event Bus Configuration
channel:
  poll_jobs_channel_size: 100
  metric_results_channel_size: 100
  cache_events_channel_size: 50
  state_signal_channel_size: 50
  discovery_events_channel_size: 50
  device_validated_channel_size: 100

# Logging
logging:
  level: "debug"
  format: "json"
  output: "stdout"
  file_path: "/var/log/nms/nms.log"
